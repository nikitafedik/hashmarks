# Load bookmarks from BOOKMARK_FILE into named directory hash table.

init_hashmarks() {
  emulate -L zsh
  local file key dir

  # Remove previously loaded named dirs tracked in BOOKMARKS_LOADED
  typeset -ga BOOKMARKS_LOADED
  if (( ${#BOOKMARKS_LOADED[@]} )); then
    for key in "${BOOKMARKS_LOADED[@]}"; do
      hash -d "$key" 2>/dev/null || true
    done
  fi
  BOOKMARKS_LOADED=()

  # Load and hash all entries from the file
  file=$(_zb_file)
  [[ -r $file ]] || return 0
  while IFS='=' read -r key dir; do
    [[ -z $key || -z $dir ]] && continue
    case $dir in
      "~"*) dir="${dir/#\~/$HOME}" ;;
    esac
    hash -d "$key=$dir" 2>/dev/null || true
    BOOKMARKS_LOADED+=("$key")
  done < "$file"
}
